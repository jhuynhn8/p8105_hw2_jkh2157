---
title: "p8105_hw2_jkh2157"
output: github_document
date: "2025-09-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading Libraries 

```{r}
library(tidyverse)
library(knitr)
library(readxl)
```

## Problem 1

Step 1a: Clean the data in pols-month

```{r}
pols_df=
  read_csv("datasets/fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate (mon, into = c("year","month","day"),sep="-") %>% 
  mutate(
    month = recode(month,`01`="Jan",`02`="Feb",`03`="Mar",`04`="Apr",`05`="May",`06`="Jun",`07`="Jul",`08`="Aug",`09`="Sep",`10`="Oct",`11`="Nov",`12`="Dec"),
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem ==1 ~ "dem"
    ),
    year=as.character(year)
  ) %>% 
  select(year,month,president,everything(),-day,-prez_gop,-prez_dem)
knitr::kable(head(pols_df,10))
```

Step 1b: Clean the data for snp.csv 

```{r}
snp_df=
  read_csv("datasets/fivethirtyeight_datasets/snp.csv") %>% 
  separate(date, into=c("month","date","year"), sep = "/") %>% 
  mutate(
    month = recode(month,`1`="Jan",`2`="Feb",`3`="Mar",`4`="Apr",`5`="May",`6`="Jun",`7`="Jul",`8`="Aug",`9`="Sep",`10`="Oct",`11`="Nov",`12`="Dec"),
    year=case_when(
      as.numeric(year)>=50 ~ paste0("19",year),
      as.numeric(year)<50 ~ paste0("20",year)
    )) %>% 
  mutate(year=as.character(year)) %>% 
  select(year,month,close) %>% 
  arrange(year,month)
knitr::kable(head(snp_df,10))
```

Step 1c: tidy unemploymeny data 

```{r}
unemployment_df=
  read_csv("datasets/fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols=jan:dec,
    names_to="month",
    values_to="unemployment") %>% 
  mutate(
    month=str_to_title(month),
    year=as.character(year)) %>% 
  select(year,month,unemployment)
knitr::kable(head(unemployment_df,10))
```

Step 1d: merge data sets 

```{r}
final_df=left_join(pols_df,snp_df,by=c("year","month"))
final_df=left_join(final_df,unemployment_df,by=c("year","month"))
knitr::kable(head(final_df,15))
```

The pols data set (822 rows and 9 columns) contains the monthly counts of Democratic and Republican governors,senators, and representatives. The snp data set (787 rows and 3 columns) looks at the monthly closing values of the S&P index, starting in 1950 which explains why there are some NA values. The unemployment data set (816 rows and 3 columns) reports monthly US unemployment rates starting in 1948. After cleaning and merging these data sets we get a new frame that ranges from Jan 1947 to Jun 2015, with variables including year, month, president, congressional bodies, stock market performance (close), and unemployment rates. The dimensions of the final table contains 822 rows and 11 columns.

## Problem 2 

Step 2a: Cleaning up mrTrash

```{r}
mr_trash_df=
  read_excel("datasets/trash_wheel_data2.xlsx", sheet="Mr. Trash Wheel", range = "A2:N655") %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
mutate(
  sports_balls=as.integer(round(sports_balls)),
  identity = "mr",
  year=as.numeric(year)
)
knitr::kable(head(mr_trash_df,10))
```

Step 2b: Cleaning up Professor Trash 

```{r}
prof_trash_df=
  read_excel("datasets/trash_wheel_data2.xlsx", sheet="Professor Trash Wheel", range="A2:M123") %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    identity="prof",
    year=as.numeric(year)
  )
knitr::kable(head(prof_trash_df,10))
```

Step 2c: Cleaning up Gwynnda data 

```{r}
gwyn_trash_df=
  read_excel("datasets/trash_wheel_data2.xlsx", sheet="Gwynns Falls Trash Wheel", range = "A2:L266") %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    identity="gwynn",
    year=as.numeric(year)
  )
knitr::kable(head(gwyn_trash_df,10))
```

Step 2d: merging the data sets 

```{r}
trash_wheels = bind_rows(mr_trash_df,prof_trash_df,gwyn_trash_df)

knitr::kable(head(trash_wheels,15))

total_weight_prof = prof_trash_df %>%
  summarise(total_weight = sum(weight_tons, na.rm = TRUE))

total_cigs_gwyn = gwyn_trash_df %>%
  filter(year == 2022, month == "June") %>%
  summarise(total_cigs = sum(cigarette_butts, na.rm = TRUE))
```

The combined Trash Wheel dataset contains **`r nrow(trash_wheels)`** observations and **`r ncol(trash_wheels)`** variables. Some key variables included the weight of trash collected, cigarette butts collected, plastic bottles, and identifier for which trash wheel the data came from. Professor Trash Wheel collected a total of **`r total_weight_prof$total_weight`** tons of trash. In June 2022, Gwyn collected **`r total_cigs_gwyn$total_cigs`** cigarette butts.

## Problem 3 

Step 3a: wrangle data for Zip 

```{r}
zip_df=
  read_csv("datasets/zillow_data/ZIP.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code,county_code,county_fips,neighborhood,state_fips,file_date)
knitr::kable(head(zip_df,10))
```

Step 3b: Clean the ZORI data 

```{r}
zori_df=
  read_csv("datasets/zillow_data/ZORI.csv") %>% 
  janitor::clean_names() %>% 
  rename(zip_code=region_name) %>% 
  pivot_longer(
    cols=starts_with("x20"),
    names_to="date",
    values_to = "rent_price"
  ) %>% 
  mutate(
    date=str_remove(date,"x"),
    date=ymd(date))
knitr::kable(head(zori_df,10))
```

Step 3c: merge the data sets using zipcode, remove redunancies, and reorganize columns names here as well 

```{r}
final_zillow_df= left_join(zori_df,zip_df,by="zip_code",relationship="many-to-many") %>% 
  select(-state_name,-region_type,-file_date) %>% 
  relocate(zip_code,neighborhood,county_name,city,state,metro,date,rent_price)
knitr::kable(head(final_zillow_df,10))
```

## Summaries for Problem 3: 

Observations and unique: 
```{r}
obs_n = nrow(final_zillow_df)
distinct_zips = dplyr::n_distinct(final_zillow_df$zip_code)
distinct_neighborhoods = dplyr::n_distinct(final_zillow_df$neighborhood)
```
There are 17516 observations with 149 unique zip codes and 43 distinct neighborhoods 

Zips present in ZIP but missing from ZORI: 
```{r}
zips_missing_in_zori = zip_df %>%
  anti_join(distinct(zori_df,zip_code), by = "zip_code")
knitr::kable(head(zips_missing_in_zori,10))
```
There are 171 zip codes that appear in the ZIP data set but not in the Zillow rental price data set. This could be because zillow does not have residential areas at the specific code, meaning that there would be no set prices. For example, the 10499 zip code could be referring to a PO box address so it lacks any residential listing. Other ZIPs like 10705 may fall outside of Zillowâ€™s defined NYC metro boundaries. 

Rental Price fluctuations 
```{r}

```





